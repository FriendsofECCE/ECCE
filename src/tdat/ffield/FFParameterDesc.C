////////////////////////////////////////////////////////////////////////////////
// FFParameterDesc Class
//
//
// DESIGN:  
//
////////////////////////////////////////////////////////////////////////////////

#include <string.h>
#include <float.h>
#include <limits.h>

#include "util/ErrMsg.H"

#include "tdat/FFParameterDesc.H"

//-------------------Constructor------------------------------------------------
////////////////////////////////////////////////////////////////////////////////
// Description: Constructor
//
// Param: type parameter type object
//
////////////////////////////////////////////////////////////////////////////////
FFParameterDesc::FFParameterDesc( ParamType type)
:  p_type ( type)
{
   initialize();
}

//-------------------Destructor-------------------------------------------------
////////////////////////////////////////////////////////////////////////////////
// Description: Destructor
//
////////////////////////////////////////////////////////////////////////////////
FFParameterDesc::~FFParameterDesc( void)
{
}

//-------------------Public Methods---------------------------------------------
////////////////////////////////////////////////////////////////////////////////
// Description: Registers the parameter label
//
// Param: label string to be used as parameter label
//
////////////////////////////////////////////////////////////////////////////////
void FFParameterDesc::setLabel( const string& label)
{
   p_label = label;
}

////////////////////////////////////////////////////////////////////////////////
// Description: Registers the default unit. If the current unit is empty, the
//              current unit it also set to the default unit.
//
// Param: unit default unit object
//
////////////////////////////////////////////////////////////////////////////////
void FFParameterDesc::setDefaultUnit( const string& unit)
{
   p_defaultUnit = unit;
}

////////////////////////////////////////////////////////////////////////////////
// Description: Registers the current unit
//
// Param: unit current unit object
//
////////////////////////////////////////////////////////////////////////////////
void FFParameterDesc::setUnitClass( const string& unit)
{
   p_unitClass = unit;
}

////////////////////////////////////////////////////////////////////////////////
// Description: Registers the valid string values for this parameter
//
// Param: valids vector of valid strings for this parameter
//
////////////////////////////////////////////////////////////////////////////////
void FFParameterDesc::setValidStrings( const vector<string>& valids)
{
   p_validStrings = valids;
}

////////////////////////////////////////////////////////////////////////////////
// Description: Registers the minimum integer value for this parameter (applies
//              only if this is an eINT type parameter).
//
// Param: min minimum valid value for this parameter
//
////////////////////////////////////////////////////////////////////////////////
void FFParameterDesc::setMinInt( int min)
{
   p_minInt = min;
}

////////////////////////////////////////////////////////////////////////////////
// Description: Registers the maximum integer value for this parameter (applies
//              only if this is an eINT type parameter).
//
// Param: max maximum valid value for this parameter
//
////////////////////////////////////////////////////////////////////////////////
void FFParameterDesc::setMaxInt( int max)
{
   p_maxInt = max;
}

void FFParameterDesc::setDefaultValue(const string& value)
{
   p_defaultValue = value;
}

////////////////////////////////////////////////////////////////////////////////
// Description: Registers the minimum float value for this parameter (applies
//              only if this is an eFLOAT type parameter).
//
// Param: min minimum valid value for this parameter
//
////////////////////////////////////////////////////////////////////////////////
void FFParameterDesc::setMinFloat( float min)
{
   p_minFloat = min;
}

////////////////////////////////////////////////////////////////////////////////
// Description:  Registers the maximum float value for this parameter (applies
//              only if this is an eFLOAT type parameter).
//
// Param: max maximum valid value for this parameter
//
////////////////////////////////////////////////////////////////////////////////
void FFParameterDesc::setMaxFloat( float max)
{
   p_maxFloat = max;
}

////////////////////////////////////////////////////////////////////////////////
// Description: Retrieves this parameter type
//
// Return: parameter type
//
////////////////////////////////////////////////////////////////////////////////
FFParameterDesc::ParamType FFParameterDesc::getType() const
{
   return p_type;
}

////////////////////////////////////////////////////////////////////////////////
// Description: Retrieves the parameter label
//
// Return: label to be used as parameter label
//
////////////////////////////////////////////////////////////////////////////////
string FFParameterDesc::getLabel() const
{
   return p_label;
}

////////////////////////////////////////////////////////////////////////////////
// Description: Retrieves the current unit 
//
// Return: current unit
//
////////////////////////////////////////////////////////////////////////////////
string FFParameterDesc::getUnitClass() const
{
   return p_unitClass;
}

////////////////////////////////////////////////////////////////////////////////
// Description:  Retrieves the default unit
//
// Return: default unit
//
////////////////////////////////////////////////////////////////////////////////
string FFParameterDesc::getDefaultUnit() const
{
   return p_defaultUnit;
}

////////////////////////////////////////////////////////////////////////////////
// Description: Retrieve valid value strings
//
// Return: vector of valid value strings for this parameter
//
////////////////////////////////////////////////////////////////////////////////
vector<string> FFParameterDesc::getValidStrings() const
{
   return p_validStrings;
}

////////////////////////////////////////////////////////////////////////////////
// Description: Tests if input string matches any of the valid strings
//
// Return: true if the input string matches any of the valid strings, false
//         otherwise
//
////////////////////////////////////////////////////////////////////////////////
bool FFParameterDesc::isValid( const string& in) const
{
   EE_ASSERT( p_type == eSTRING, EE_FATAL, 
          "FFParameterDesc::isValid(<string>) called for non-string parameter");

   bool retVal = false;
   vector<string>::const_iterator iter = p_validStrings.begin();
   while ( iter != p_validStrings.end())  {
      if ( in.compare( *iter) == 0)  {
         retVal = true;
         break;
      }
      iter++;
   }
   return retVal;
}

////////////////////////////////////////////////////////////////////////////////
// Description: Retrieves minimum values
//
// Return minimum value for this paremter
//
////////////////////////////////////////////////////////////////////////////////
int FFParameterDesc::getMinInt() const
{
   return p_minInt;
}

////////////////////////////////////////////////////////////////////////////////
// Description: Retrieves maximum values
//
// Return maximum value for this paremter
//
////////////////////////////////////////////////////////////////////////////////
int FFParameterDesc::getMaxInt() const
{
   return p_maxInt;
}

string FFParameterDesc::getDefaultValue() const
{
   return p_defaultValue;
}

////////////////////////////////////////////////////////////////////////////////
// Description: Tests if input integer is in range
//
// Return: true if the input integer is in range, false otherwise
//
////////////////////////////////////////////////////////////////////////////////
bool FFParameterDesc::isValid( int in) const
{
   EE_ASSERT( p_type == eINT, EE_FATAL, 
          "FFParameterDesc::isValid(<int>) called for non-integer parameter");

   return in >= p_minInt && in <= p_maxInt;
}

////////////////////////////////////////////////////////////////////////////////
// Description: Retrieves minimum values
//
// Return minimum value for this paremter
//
////////////////////////////////////////////////////////////////////////////////
float FFParameterDesc::getMinFloat() const
{
   return p_minFloat;
}

////////////////////////////////////////////////////////////////////////////////
// Description: Retrieves maximum values
//
// Return maximum value for this paremter
//
////////////////////////////////////////////////////////////////////////////////
float FFParameterDesc::getMaxFloat() const
{
   return p_maxFloat;
}

////////////////////////////////////////////////////////////////////////////////
// Description: Tests if input float is in range
//
// Return: true if the input float is in range, false otherwise
//
////////////////////////////////////////////////////////////////////////////////
bool FFParameterDesc::isValid( float in) const
{
   EE_ASSERT( p_type == eINT, EE_FATAL, 
          "FFParameterDesc::isValid(<float>) called for non-float parameter");

   return in >= p_minFloat && in <= p_maxFloat;
}

////////////////////////////////////////////////////////////////////////////////
// Description: Sets initial/default values for validation variables.
//
////////////////////////////////////////////////////////////////////////////////
void FFParameterDesc::initialize()
{
   if ( p_type == eSTRING)  {
      p_validStrings.clear();
   } 
   if ( p_type == eINT)  {
      p_minInt = INT_MIN;
      p_maxInt = INT_MAX;
   }
   if ( p_type == eFLOAT)  {
      p_minFloat = FLT_MIN;
      p_maxFloat = FLT_MAX;
   }
}
